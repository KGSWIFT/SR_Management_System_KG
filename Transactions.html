<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KG SWIFT SYSTEM-Transactions</title>
    <link rel="icon" href="KG_SWIFT2.ico">
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            text-align: center;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #welcome {
            background-color: rgba(255, 255, 255, 0.95);
            color: #2a5298;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 0.5s ease-out;
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.98);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.25);
            color: #333;
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: slideUp 0.5s ease-out;
        }

        .logo {
            width: 200px;
            margin-bottom: 30px;
            filter: drop-shadow(0 6px 12px rgba(0,0,0,0.15));
        }

        h2, h3 {
            color: #1e3c72;
            font-size: 34px;
            font-weight: 800;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(45deg, #1e3c72, #4a90e2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding-bottom: 15px;
            border-bottom: 3px solid #4a90e2;
        }

        .info-box {
            font-size: 20px;
            margin: 15px 0;
            padding: 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
        }

        .today-box {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        select, input {
            padding: 15px 25px;
            margin: 15px auto;
            border: 2px solid #4a90e2;
            border-radius: 12px;
            background: white;
            color: #333;
            width: 80%;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        select:focus, input:focus {
            outline: none;
            border-color: #1e3c72;
            box-shadow: 0 0 0 4px rgba(30, 60, 114, 0.25);
            transform: translateY(-2px);
        }

        button {
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 1px;
            min-width: 200px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        button:hover {
            background: linear-gradient(135deg, #357abd, #2a5298);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .report-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60) !important;
        }

        .report-btn:hover {
            background: linear-gradient(135deg, #27ae60, #219653) !important;
        }

        .hidden {
            display: none !important;
        }

        .login-container {
            max-width: 500px;
            width: 90%;
            margin: auto;
            padding: 60px 40px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border: 3px solid rgba(255, 255, 255, 0.4);
            animation: popIn 0.6s ease-out;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        .login-form button {
            width: 85%;
            padding: 18px;
            font-size: 20px;
            font-weight: 700;
            margin-top: 20px;
        }

        .pin-container {
            position: relative;
            width: 85%;
            margin: 20px auto;
        }

        #pin {
            font-size: 28px !important;
            letter-spacing: 12px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            padding: 20px;
            border: 3px solid #4a90e2;
            background: #f8fafc;
            width: 100% !important;
            margin: 0 !important;
        }

        .pin-label {
            font-size: 20px;
            color: #1e3c72;
            margin-bottom: 15px;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            border: 3px solid #4a90e2;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        th, td {
            padding: 18px;
            border: 1px solid #e0e0e0;
            text-align: center;
            font-size: 16px;
        }

        th {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        tr:hover {
            background-color: rgba(74, 144, 226, 0.15);
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            gap: 15px;
        }

        .pagination button {
            background: #4a90e2;
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            width: auto;
            min-width: 120px;
            font-weight: 600;
            margin: 0;
        }

        .pagination button:disabled {
            background: #b0b0b0;
            cursor: not-allowed;
            transform: none;
        }

        #pageInfo {
            font-size: 18px;
            font-weight: 700;
            color: #1e3c72;
            margin: 0 20px;
            padding: 12px 24px;
            background: rgba(74, 144, 226, 0.15);
            border-radius: 10px;
            border: 2px solid #4a90e2;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            margin: 8% auto;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            border-radius: 25px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            text-align: right;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .modal-content h3 {
            color: #1e3c72;
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
        }

        .close {
            color: #777;
            float: left;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: #e74c3c;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 30px;
        }

        .modal-buttons button {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            font-weight: 700;
            margin: 0;
        }

        .edit-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .cancel-btn {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .current-user {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 25px;
            color: #1e3c72;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #4a90e2;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 25px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            margin: 0;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 25px;
            }
            
            .button-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .button-container button {
                width: 100%;
            }
            
            select, input {
                width: 95% !important;
            }
            
            .modal-content {
                width: 95%;
                margin: 20% auto;
            }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="login-container" id="login-container">
        <img src="KG_SWIFT.png" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" class="logo">
        <h2>KG SWIFT SYSTEM</h2>
        <h3>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
        <div class="login-form">
            <div class="pin-label">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… PIN Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</div>
            <div class="pin-container">
                <input type="password" id="pin" placeholder="0 0 0 0 0" maxlength="5" inputmode="numeric" onkeypress="handleKeyPress(event)">
            </div>
            <button onclick="checkPin()">ğŸ”“ Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            <button onclick="goToHomePage()">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
    <div class="hidden" id="welcome">
        <img src="KG_SWIFT.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="logo">
        <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h2>
        <div id="userGreeting" style="margin-top: 20px; font-size: 20px;"></div>
    </div>

    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="hidden" id="main-container">
        <div id="currentUserDisplay" class="current-user"></div>
        <button class="logout-btn" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        
        <div class="container">
            <img src="KG_SWIFT.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="logo">
            <h2>KG SWIFT SYSTEM</h2>
            <p style="margin-bottom: 30px; font-size: 26px; color: #1e3c72; font-weight: 700;">Ù†Ø¸Ø§Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</p>

            <div class="info-box today-box" id="todayTransactionsInfo">ğŸ“… Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

            <input type="text" id="transactionId" placeholder="ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©">
            <select id="engineer">
                <option value="">ğŸ‘¨â€ğŸ’¼ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³</option>
                <option value="Ø£Ø³Ù…Ø§Ø¡ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø¯ÙŠØ©">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³Ø© Ø£Ø³Ù…Ø§Ø¡ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø¯ÙŠØ©</option>
                <option value="Ø±Ø­Ù…Ø© Ø³ÙŠÙ Ø§Ù„ØµØ¨Ø­ÙŠØ©">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³Ø© Ø±Ø­Ù…Ø© Ø³ÙŠÙ Ø§Ù„ØµØ¨Ø­ÙŠØ©</option>
                <option value="Ø¹Ø§Ø¦Ø´Ø© Ø±Ø§Ø´Ø¯ Ø§Ù„ØºÙŠØ«ÙŠØ©">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³Ø© Ø¹Ø§Ø¦Ø´Ø© Ø±Ø§Ø´Ø¯ Ø§Ù„ØºÙŠØ«ÙŠØ©</option>
            </select>
            
            <select id="transactionType">
                <option value="">ğŸ¢ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„</option>
                <option value="Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©">Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©</option>
                <option value="Ø£Ø¨Ø±Ø§Ø¬ Ø§ØªØµØ§Ù„Ø§Øª">Ø£Ø¨Ø±Ø§Ø¬ Ø§ØªØµØ§Ù„Ø§Øª</option>
                <option value="Ø­ÙƒÙˆÙ…ÙŠ">Ø­ÙƒÙˆÙ…ÙŠ</option>
                <option value="ØªØ¬Ø§Ø±ÙŠ">ØªØ¬Ø§Ø±ÙŠ</option>
            </select>
            
            <select id="requestType">
                <option value="">ğŸ“„ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</option>
                <option value="Ø¥Ø¨Ø§Ø­Ø© Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©">Ø¥Ø¨Ø§Ø­Ø© Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©</option>
                <option value="Ù…ÙˆØ§ÙÙ‚Ø© ÙÙ†ÙŠØ©">Ù…ÙˆØ§ÙÙ‚Ø© ÙÙ†ÙŠØ©</option>
                <option value="Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„</option>
            </select>

            <input type="text" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª" oninput="searchTransactions()">
            
            <div class="button-container">
                <button onclick="addTransaction()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</button>
                <button onclick="clearFields()">ğŸ—‘ï¸ ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
                <button onclick="deleteTransaction()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨</button>
                <button onclick="openEditModal()">âœï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨</button>
                <button class="report-btn" onclick="sendDailyReport()">ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</button>
            </div>

            <h3>ğŸ“‹ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
            <div id="transactionsList"></div> 
            <div class="pagination">
                <button onclick="previousPageMain()" id="prevPageMain">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <span id="pageInfo"></span>
                <button onclick="nextPageMain()" id="nextPageMain">Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
            </div>
        </div>
    </div>

    <!-- Modal Ù„Ù„ØªØ­Ø¯ÙŠØ« -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h3>âœï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨</h3>
            <input type="text" id="editTransactionId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©">
            <select id="editEngineer">
                <option value="">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³</option>
                <option value="Ø£Ø³Ù…Ø§Ø¡ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø¯ÙŠØ©">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³Ø© Ø£Ø³Ù…Ø§Ø¡ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø¯ÙŠØ©</option>
                <option value="Ø±Ø­Ù…Ø© Ø³ÙŠÙ Ø§Ù„ØµØ¨Ø­ÙŠØ©">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³Ø© Ø±Ø­Ù…Ø© Ø³ÙŠÙ Ø§Ù„ØµØ¨Ø­ÙŠØ©</option>
            </select>
            <select id="editTransactionType">
                <option value="">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„</option>
                <option value="Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©">Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©</option>
                <option value="Ø£Ø¨Ø±Ø§Ø¬ Ø§ØªØµØ§Ù„Ø§Øª">Ø£Ø¨Ø±Ø§Ø¬ Ø§ØªØµØ§Ù„Ø§Øª</option>
            </select>
            <select id="editRequestType">
                <option value="">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</option>
                <option value="Ø¥Ø¨Ø§Ø­Ø© Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©">Ø¥Ø¨Ø§Ø­Ø© Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©</option>
                <option value="Ù…ÙˆØ§ÙÙ‚Ø© ÙÙ†ÙŠØ©">Ù…ÙˆØ§ÙÙ‚Ø© ÙÙ†ÙŠØ©</option>
            </select>
            <div class="modal-buttons">
                <button class="edit-btn" onclick="submitEditTransaction()">ØªØ­Ø¯ÙŠØ«</button>
                <button class="cancel-btn" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxWKr81EaQpTfJhOznYbiKbFQ2GVQzQ2jVKAJ-H53IxavkxoACsKWOlVuxwjR00Lq6Pzg/exec";

        const VALID_PINS = {
            '12345': { name: 'Ø®Ø§Ù„Ø¯ ÙŠØ¹Ù‚ÙˆØ¨ Ø§Ù„ØºØ²Ø§Ù„ÙŠ', isAdmin: true },
            '54321': { name: 'Ø®Ø§Ù„Ø¯ ÙŠØ¹Ù‚ÙˆØ¨ Ø§Ù„ØºØ²Ø§Ù„ÙŠ', isAdmin: true },
            '11111': { name: 'Ø§Ù…Ù„ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø³Ù†ÙŠØ©', isAdmin: false },
            '22222': { name: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ø±ÙÙŠ', isAdmin: false },
            '33333': { name: 'Ø¨Ø¯Ø± Ø³ÙˆÙŠØ¯Ø§Ù† Ø§Ù„Ø´Ø±Ø¬ÙŠ', isAdmin: false }
        };

        let transactions = [];
        let currentPageMain = 1;
        const rowsPerPage = 10;
        let currentUser = null;

        function checkPin() {
            const pin = document.getElementById("pin").value.trim();
            
            console.log("PIN Ø§Ù„Ù…Ø¯Ø®Ù„:", pin);
            console.log("PINs Ø§Ù„Ù…ØªØ§Ø­Ø©:", Object.keys(VALID_PINS));
            
            if (!pin || pin.length !== 5 || !/^\d+$/.test(pin)) {
                alert("âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† PIN Ù…ÙƒÙˆÙ† Ù…Ù† 5 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·");
                document.getElementById("pin").value = '';
                document.getElementById("pin").focus();
                return;
            }

            if (VALID_PINS[pin]) {
                currentUser = {
                    pin: pin,
                    name: VALID_PINS[pin].name,
                    isAdmin: VALID_PINS[pin].isAdmin
                };

                console.log("ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­:", currentUser);

                document.getElementById("login-container").classList.add("hidden");
                document.getElementById("welcome").classList.remove("hidden");
                document.getElementById("userGreeting").innerHTML = 
                    `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ <strong>${currentUser.name}</strong>`;
                
                setTimeout(() => {
                    document.getElementById("welcome").classList.add("hidden");
                    document.getElementById("main-container").classList.remove("hidden");
                    document.getElementById("currentUserDisplay").innerHTML = 
                        `ğŸ‘¤ ${currentUser.name} ${currentUser.isAdmin ? '(Ù…Ø¯ÙŠØ±)' : ''}`;
                    
                    loadTransactionsFromDB();
                }, 2000);
                
                document.getElementById("pin").value = '';
            } else {
                alert("âŒ PIN ØºÙŠØ± ØµØ­ÙŠØ­");
                document.getElementById("pin").value = '';
                document.getElementById("pin").focus();
            }
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                checkPin();
            }
        }

        function logout() {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
                currentUser = null;
                transactions = [];
                currentPageMain = 1;
                document.getElementById("main-container").classList.add("hidden");
                document.getElementById("login-container").classList.remove("hidden");
                document.getElementById("pin").value = "";
                document.getElementById("pin").focus();
            }
        }

        function goToHomePage() {
            window.location.href = "index.html";
        }

        function clearFields() {
            document.getElementById('engineer').value = '';
            document.getElementById('transactionId').value = '';
            document.getElementById('transactionType').value = '';
            document.getElementById('requestType').value = '';
        }

        function searchTransactions() {
            const searchValue = document.getElementById('search').value.toLowerCase();
            const filtered = transactions.filter(tx =>
                String(tx.id).includes(searchValue) ||
                tx.engineer.toLowerCase().includes(searchValue) ||
                tx.type.toLowerCase().includes(searchValue) ||
                tx.requestType.toLowerCase().includes(searchValue)
            );

            currentPageMain = 1;
            displaySearchResults(filtered);
        }

        function displaySearchResults(list) {
            const container = document.getElementById("transactionsList");
            container.innerHTML = "";

            if (list.length === 0) {
                container.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>";
                return;
            }

            const start = (currentPageMain - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageData = list.slice(start, end);

            let html = '<table><thead><tr><th>Ø±Ù‚Ù…</th><th>Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³</th><th>Ù†ÙˆØ¹</th><th>Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead><tbody>';
            pageData.forEach(tx => {
                html += `<tr><td>${tx.id}</td><td>${tx.engineer}</td><td>${tx.type}</td><td>${tx.requestType}</td><td>${new Date(tx.date).toLocaleDateString('ar-EG')}</td></tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;

            const totalPages = Math.ceil(list.length / rowsPerPage);
            document.getElementById("pageInfo").textContent = `ØµÙØ­Ø© ${currentPageMain} Ù…Ù† ${totalPages}`;
            document.getElementById("prevPageMain").disabled = currentPageMain <= 1;
            document.getElementById("nextPageMain").disabled = currentPageMain >= totalPages;
        }

        function openEditModal() {
            if (!currentUser) {
                alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
                return;
            }
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('editTransactionId').value = '';
            document.getElementById('editEngineer').value = '';
            document.getElementById('editTransactionType').value = '';
            document.getElementById('editRequestType').value = '';
        }

        async function addTransaction() {
            if (!currentUser) {
                alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
                return;
            }

            const engineer = document.getElementById('engineer').value;
            const transactionId = document.getElementById('transactionId').value.trim();
            const transactionType = document.getElementById('transactionType').value;
            const requestType = document.getElementById('requestType').value;

            if (!engineer || !transactionId || !transactionType || !requestType) {
                alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
                return;
            }

            try {
                const params = new URLSearchParams();
                params.append('action', 'addTransaction');
                params.append('id', transactionId);
                params.append('engineer', engineer);
                params.append('type', transactionType);
                params.append('requestType', requestType);

                const response = await fetch(SCRIPT_URL, { method: 'POST', body: params });
                const data = await response.json();
                
                if (data.error) {
                    alert(data.error);
                } else {
                    transactions.push({
                        id: transactionId,
                        engineer,
                        type: transactionType,
                        requestType,
                        date: new Date().toISOString(),
                        createdAt: new Date().getTime()
                    });
                    currentPageMain = 1;
                    updateTransactionList();
                    alert("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!");
                    clearFields();
                }
            } catch (error) {
                alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
            }
        }

        async function submitEditTransaction() {
            const id = document.getElementById('editTransactionId').value.trim();
            const engineer = document.getElementById('editEngineer').value;
            const type = document.getElementById('editTransactionType').value;
            const requestType = document.getElementById('editRequestType').value;

            if (!engineer || !type || !requestType) {
                alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
                return;
            }

            const tx = transactions.find(t => String(t.id) === id);
            if (!tx) {
                alert("âš ï¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©");
                return;
            }

            try {
                const params = new URLSearchParams();
                params.append('action', 'editTransaction');
                params.append('oldId', id);
                params.append('id', id);
                params.append('engineer', engineer);
                params.append('type', type);
                params.append('requestType', requestType);

                const response = await fetch(SCRIPT_URL, { method: 'POST', body: params });
                const data = await response.json();
                
                if (data.error) {
                    alert(data.error);
                } else {
                    tx.engineer = engineer;
                    tx.type = type;
                    tx.requestType = requestType;
                    updateTransactionList();
                    alert("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!");
                    closeEditModal();
                }
            } catch (error) {
                alert(`âŒ Ø®Ø·Ø£: ${error.message}`);
            }
        }

        async function deleteTransaction() {
            const id = document.getElementById('transactionId').value.trim();
            if (!id) {
                alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©");
                return;
            }

            if (!transactions.find(t => String(t.id) === id)) {
                alert("âš ï¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©");
                return;
            }

            if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©ØŸ")) return;

            try {
                const params = new URLSearchParams();
                params.append('action', 'deleteTransaction');
                params.append('id', id);

                const response = await fetch(SCRIPT_URL, { method: 'POST', body: params });
                const data
